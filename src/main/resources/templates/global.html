<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head th:fragment="head(title)">
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet" href="/mycloud/static/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"/>
    <link th:href="@{/css/bootstrap-theme.min.css}" rel="stylesheet" href="/mycloud/static/css/bootstrap-theme.min.css"
          integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous"/>
    <link th:href="@{/image/favicon.ico}" rel="shortcut icon" type="image/ico" href="/mycloud/static/image/favicon.ico"/>
    <title th:text="${title}">global</title>
</head>
<body>
<div class="container">

    <div class="row" th:fragment="navigation">
        <nav class="navbar navbar-default" role="navigation">
            <div class="container-fluid">
                <div class="navbar-header">
                    <a class="navbar-brand" th:href="@{/admin/1}">mycloud</a>
                </div>
                <div>
                    <ul class="nav navbar-nav">
                        <li><a></a></li>
                    </ul>
                </div>
            </div>
        </nav>
    </div>

    <div class="row" th:fragment="uploadFileForm(token)">
        <div class="page-header">
            <h3>上传文件</h3>
        </div>
        <form th:action="@{/api/uploadFile}" method="post" class="form-horizontal" role="form" enctype="multipart/form-data">
            <input th:value="${token}" name="token" type="hidden" required="required"/>
            <div class="form-group">
                <label class="col-sm-2 control-label">上传日期</label>
                <div class="col-sm-10">
                    <input type="file" name="file" class="form-control" required="required"/>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label">上传日期</label>
                <div class="col-sm-10">
                    <input th:value="${#dates.format(new java.util.Date(),'yyyy-MM-dd')}" type="date" name="date" class="form-control"/>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label">是否备份</label>
                <div class="col-sm-10">
                    <label class="radio-inline">
                        <input type="radio" name="status" value="1" checked="checked"/> 备份
                    </label>
                    <label class="radio-inline">
                        <input type="radio" name="status"  value="0"/> 不备份
                    </label>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label">描述</label>
                <div class="col-sm-10">
                    <textarea name="description" maxlength="255" class="form-control"></textarea>
                </div>
            </div>
            <div class="form-group">
                <div class="col-sm-10"></div>
                <div class="col-sm-2">
                    <button type="submit" class="btn btn-default">上传</button>
                </div>
            </div>
        </form>
    </div>

    <div class="row" th:fragment="inquire">
        <div class="page-header">
            <h3>查询</h3>
        </div>
        <form th:action="@{/admin}" method="get" class="form-inline" role="form">
            <div class="form-group">
                <label>上传日期</label>
                <input th:value="${#dates.format(new java.util.Date(),'yyyy-MM-dd')}" name="date" type="date" class="form-control" required="required"/>
            </div>
            <button type="submit" class="btn btn-default">查询</button>
        </form>
        <br/>
        <form th:action="@{/admin}" method="get" class="form-inline" role="form">
            <div class="form-group">
                <label>匹配文件名</label>
                <input name="filename" type="text" class="form-control" required="required"/>
            </div>
            <button type="submit" class="btn btn-default">查询</button>
        </form>
        <br/>
        <form th:action="@{/admin}" method="get" class="form-inline" role="form">
            <div class="form-group">
                <label>匹配描述</label>
                <input name="description" type="text" class="form-control" required="required"/>
            </div>
            <button type="submit" class="btn btn-default">查询</button>
        </form>
    </div>

    <div class="row" th:fragment="listFile(files)">
        <table class="table table-hover">
            <caption>文件列表</caption>
            <thead>
            <tr>
                <th>上传日期</th>
                <th>文件名</th>
                <th>描述</th>
                <th>链接</th>
                <th>缩略图</th>
                <th>备份</th>
                <th>恢复</th>
                <th>删除</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="file : ${files}">
                <td th:text="${#dates.format(file.date,'yyyy-MM-dd')}">2017-12-12</td>
                <td th:text="${file.filename}">xxx.txt</td>
                <td th:text="${file.description}">描述描述</td>
                <td th:text="${file.url}">/drive/xxx.txt</td>
                <td><a th:href="${file.url}" target="_blank"><img th:src="${file.url}" th:alt="${file.filename}" src="http://www.runoob.com/try/demo_source/cinqueterre.jpg" class="img-responsive" style="max-height: 10em;max-width: 10em;"/></a></td>
                <td><button th:onclick="'javascript:backup(\''+${file.filename}+'\',\''+${#dates.format(file.date,'yyyy-MM-dd')}+'\',\''+@{/admin/backup}+'\');'" type="button" class="btn btn-info">备份</button></td>
                <td><button th:onclick="'javascript:restore(\''+${file.filename}+'\',\''+${#dates.format(file.date,'yyyy-MM-dd')}+'\',\''+@{/admin/restore}+'\');'" type="button" class="btn btn-info">恢复</button></td>
                <td><button th:onclick="'javascript:remove(\''+${file.filename}+'\',\''+${#dates.format(file.date,'yyyy-MM-dd')}+'\',\''+@{/admin/remove}+'\');'" type="button" class="btn btn-danger">删除</button></td>
            </tr>
            </tbody>
        </table>
    </div>

    <div class="row" th:fragment="pages(pages)" style="text-align: center">
        <ul class="pagination">
            <li th:each="page : ${pages}"><a th:href="${page}" th:text="${page}">1</a></li>
        </ul>
    </div>

    <div class="row" th:fragment="loginForm(info)">
        <div class="page-header">
            <h1>mycloud后台管理登录</h1>
        </div>
        <form th:action="@{/}" method="post" class="form-horizontal" role="form">
            <div class="form-group">
                <label class="col-sm-2 control-label">口令</label>
                <div class="col-sm-10">
                    <input name="token" type="password" class="form-control" placeholder="口令" required="required"/>
                </div>
            </div>
            <div class="form-group">
                <div class="col-sm-10">
                    <button type="submit" class="btn btn-default">登录</button>
                    <span th:text="${info}" class="label label-danger">口令错误</span>
                </div>
            </div>
        </form>
    </div>

    <div class="row" th:fragment="status(failBackupCount,successBackupCount,waitBackupCount,failRestoreCount,successRestoreCount,waitRestoreCount)">
        <div class="page-header">
            <h3>全局概况</h3>
        </div>
        <table class="table table-hover">
            <thead>
            <tr>
                <th>备份失败</th>
                <th>备份成功</th>
                <th>备份队列</th>
                <th>全部备份</th>
                <th>恢复失败</th>
                <th>恢复成功</th>
                <th>恢复队列</th>
                <th>全部恢复</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td th:text="${failBackupCount}">备份失败</td>
                <td th:text="${successBackupCount}">备份成功</td>
                <td th:text="${waitBackupCount}">备份队列</td>
                <td><button th:onclick="'javascript:backupAll(\''+@{/admin/backupAll}+'\');'" type="button" class="btn btn-info">全部备份</button></td>
                <td th:text="${failRestoreCount}">恢复失败</td>
                <td th:text="${successRestoreCount}">恢复成功</td>
                <td th:text="${waitRestoreCount}">恢复队列</td>
                <td><button th:onclick="'javascript:restoreAll(\''+@{/admin/restoreAll}+'\');'" type="button" class="btn btn-info">全部恢复</button></td>
            </tr>
            </tbody>
        </table>
    </div>

    <div class="row" th:fragment="tail">
        <div style="text-align: center;padding: 2%;margin-top: 2%;background-color: #2aabd2">
            <p>我的文件服务器 mycloud</p>
        </div>
    </div>

</div>

<div th:fragment="globalJs">
    <script th:src="@{/js/jquery-3.2.1.min.js}" type="text/javascript" src="/mycloud/static/js/jquery-3.2.1.min.js"></script>
    <script th:src="@{/js/bootstrap.min.js}" src="/mycloud/static/js/bootstrap.min.js"
            integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <script th:src="@{/js/global.js}" src="/mycloud/static/js/global.js"></script>
</div>
</body>
</html>